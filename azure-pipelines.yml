# Azure DevOps Pipeline para ejecutar el backend Python con secretos seguros
# Ajusta los nombres de los pasos y rutas según tu estructura

trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  - name: OPENAI_API_KEY
    value: $(OPENAI_API_KEY)

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.11'

- script: |
    echo "OPENAI-API-KEY: $OPENAI-API-KEY"
    echo "OPENAI_API_KEY: $OPENAI_API_KEY"
  displayName: 'Debug variables'

- script: |
    python --version
    pip install -r agent-backend/requirements.txt
    python agent-backend/cli.py
  displayName: 'Instala dependencias y ejecuta backend'

- script: |
    npm install -g @vscode/vsce
    npm install
    npm run compile
    vsce package
    vsce publish -p $VSCE_TOKEN
  displayName: 'Compila, empaqueta y publica extensión VS Code'
  env:
    VSCE_TOKEN: $(VSCE_TOKEN)
